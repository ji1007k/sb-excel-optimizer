# **엑셀 다운로드 성능 최적화 결과**
각 개선 단계별 성능을 메모리, 응답/처리시간, 동시성, 처리량, 안정성 측면에서 비교 테스트한 결과입니다.
이 테스트 결과는 **실무에서 겪은 OOM 문제를 기술적으로 해결한 과정**을 정량적으로 증명합니다.

### **핵심 성과**

* **하드웨어 투자 없이 소프트웨어 최적화만으로 6배 성능 향상**
* **OutOfMemoryError(OOM) 문제 안정성 확보**

---

### **테스트 환경**

* **JVM**: OpenJDK 17 (Heap 1GB / 2GB)
* **하드웨어**: CPU 4코어, RAM 16GB
* **테스트 데이터**: 10만 행 / 50만 행
* **측정 지표**: 메모리, 응답/처리시간, 동시성, 처리량, 안정성
> 참고: 실제 운영 환경(4GB Heap)에서 발생한 OOM 문제를 소규모 테스트 환경(1GB/2GB Heap)에서 재현하여 개선 효과를 검증했습니다.
---

### **최적화 방식별 기술 적용**

| 구분 | 전체 로딩 방식 | 분할 처리 방식 | 비동기 큐 방식 |
|---|---|---|---|
| Excel 라이브러리 | XSSF | SXSSF | SXSSF |
| 데이터 조회 | 전체 SELECT | ROWNUM 페이징 | ID 커서 페이징 |
| 메모리 관리 | 전체 메모리 로딩 | 청크별 처리 | 스트리밍 처리 |
| 처리 방식 | 동기 | 동기 | 비동기 |
| 동시성 제어 | 없음 | 없음 | 큐 + 스레드풀 |
| 응답 방식 | 완료 후 응답 | 완료 후 응답 | 즉시 응답 |

---

### **성능 비교 결과**

#### **10만 행 처리 성능 (1GB Heap)**

| 측정 항목 | 전체 로딩 | 분할 처리 | 비동기 큐 | 최종 개선 효과 |
|---|---|---|---|---|
| 응답시간 | 48초 | 26초 | 즉시 | 99.9% 단축 |
| 처리시간 | 48초 | 26초 | 3초 | 94% 단축 |
| 메모리 사용량 | 872MB | 17MB | 1MB | 99.9% 절약 |
| GC 시간 | 1,327ms | 2ms | 6ms | 99.5% 단축 |
| 분당 처리량 | 3개 | 4개 | 19개 | 533% 향상 |
| 동시성 | OOM 발생 | 30+ | 100+ | OOM 해결 |
| 성공률 | 100% (단일) | 100% (순차) | 100% (병렬) | 안정성 유지 |

---

#### **50만 행 처리 성능**

| 측정 항목 | 전체 로딩 | 분할 처리 | 비동기 큐 | 최종 개선 효과 |
|---|---|---|---|---|
| 응답시간 | OOM | 7분 5초 | 즉시 (7ms) | 99.9% 단축 |
| 실제 처리시간 | 불가 | 7분 5초 | 2분 23초 | 66% 단축 |
| 메모리 사용량 | OOM | 72MB | 32MB | 55% 절약 |
| GC 시간 | 불가 | 15ms | 15ms | 안정적 유지 |
| 분당 처리량 | 0개 | 0.1개 | 0.6개 | 600% 향상 |
| 성공률 | 0% | 100% | 100% | OOM 해결 |

---

### **단계별 개선 효과 분석**

#### **Step 1: 전체 로딩 → 분할 처리**

* **OOM 문제 해결**: 50만 행 처리 가능
* **처리시간 46% 단축**: 48초 → 26초
* **메모리 98% 절약**: 872MB → 17MB
* **GC 시간 99% 단축**: 1,327ms → 2ms
* **한계**: 동기 방식이라 동시 요청이 많으면 지연/부하 발생

#### **Step 2: 분할 처리 → 비동기 큐**

* **즉시 응답**: 7분 5초 → 7ms
* **쿼리 성능 향상**: ROWNUM 페이징 → ID 커서 페이징
* **실제 처리시간 66% 단축**: 7분 5초 → 2분 23초
* **처리량 600% 향상**: 0.1개/분 → 0.6개/분
* **메모리 55% 추가 절약**: 72MB → 32MB
* **안정성 확보**: 큐와 스레드풀로 동시 요청 처리 가능

> **전체 로딩 방식도 순차 처리인데 왜 OOM이 발생할까?**
>
> 순차 처리 시에도 GC에 의해 제때 해제되지 못한 이전 요청의 Workbook 메모리가 누적되어 OOM 발생 가능성이 있습니다. 또한, 분할 처리의 경우 SXSSF 라이브러리에서 일정 행 데이터 이상은 자동으로 메모리에서 해제하여 안정성을 높입니다.

---

### **메모리 증설 효과 검증**

| 방식 | 1GB Heap | 2GB Heap | 효과                  |
|---|---|---|---------------------|
| 전체 로딩 | OOM | OOM | 무효                  |
| 분할 처리 | 성공 | 성공 | 무효 (이미 효율적)         |
| 비동기 큐 | 0.6개/분 | 0.6개/분 | 유효 (확장 가능) |

---

### **향후 최적화 계획: FastExcel 적용 (예상)**

| 지표 | Apache POI | FastExcel | 개선 효과 |
|---|---|---|---|
| 메모리 | 32MB | 16MB | 50% 감소 |
| 처리속도 | 2분 23초 | 1분 12초 | 50% 향상 |
| CPU 사용률 | 80% | 60% | 25% 감소 |

---

### **핵심 결론**

#### **기술적 성과**

* **6배 처리량 향상**: 0.1개/분 → 0.6개/분 (50만 행 기준)
* **99.9% 메모리 절약**: 872MB → 1MB (10만 행 기준)
* **즉시 응답**: 7분 5초 → 7ms
* **OOM 문제 완전 해결**
* **대규모 동시 요청 안정 처리 가능**

#### **비즈니스 임팩트**

* **서비스 안정성**: OOM으로 인한 서비스 중단 위험을 제거했습니다.
* **사용자 경험**: 즉시 응답으로 사용자 경험을 개선했습니다.
* **운영 효율성**: 동일 하드웨어로 6배 더 많은 요청을 처리했습니다.
* **확장 가능성**: 데이터 증가에 대비한 아키텍처를 확보했습니다.
* **스케일업/스케일아웃**: 로드밸런싱을 통한 추가적인 성능 최적화가 가능합니다.