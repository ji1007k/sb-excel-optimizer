# **Excel 대용량 다운로드 최적화 프로젝트**

> 실무에서 겪었던 OOM 문제를 해결한 경험에 동시성 제어를 더해 대용량 엑셀 다운로드 성능을 최적화한 프로젝트  
> [🛠️ GitHub Repository 바로가기](https://github.com/ji1007k/sb-excel-optimizer)

---

### **프로젝트 개요**
* **배경**: 이전 회사 엑셀 다운로드 기능 시연 중, 대용량 데이터(10만 건) 동시 요청으로 OutOfMemoryError(OOM) 발생 → 서비스 중단 및 파일 손상
* **문제 분석**: 대용량 데이터를 메모리에 한꺼번에 로딩하는 전체 로딩 방식이 주 원인
* **목표**: 동시성 제어를 통한 대용량 엑셀 다운로드 성능과 안정성 최적화

---

### **개선 과정**

#### **1차: 실무 조치 사항 (OOM 해결)**
* **목표**: 서비스 중단의 주원인인 OOM 문제 해결 및 안정성 확보
* **조치**:
    1. **스트리밍 라이브러리 적용**: `XSSF` → `SXSSF` (일정 데이터 이상 메모리 자동 해제)
    2. **페이징 처리**: `전체 SELECT` → `1000건 페이징`
* **결과**:
    * 동시 요청 시 OOM 및 Full GC 없이 순차 처리 가능

#### **2차: 심화 최적화 (안정성 및 성능 개선)**
* **목표**: 동시성 확보 및 사용자 경험 개선
* **조치**:
    1. **동시성 제어 시스템 도입**: BlockingQueue 기반 비동기 처리로 최대 3건 동시 처리 및 즉시 응답 제공
    2. **DB 쿼리 성능 개선**: ROWNUM 기반 페이징에서 ID 기반 커서 페이징(`WHERE id > ? ORDER BY id LIMIT ?`)으로 변경하여 인덱스 활용한 조회 성능 향상
* **결과**:
    * 분당 처리량 6배 향상
    * 동시 처리 최대 요청 수 제한으로 안정성 개선
    * 즉시 응답으로 사용자 경험 개선

#### **3차: 라이브러리 최적화 (메모리 효율성 개선)**
* **목표**: 메모리 최적화 및 성능 개선
* **조치**: Apache POI → FastExcel 라이브러리 교체 적용
* **결과**: 더 높은 메모리 효율성과 쓰기 성능 확보

#### **4차: 분산 환경 대응 (확장성 개선)**
* **목표**: 다중 인스턴스 환경 지원을 위한 분산 시스템 전환
* **조치**:
    - 인메모리 상태 → Redis 기반 분산 상태 관리
    - BlockingQueue → Redis Stream/RabbitMQ 기반 메시지 큐
    - 로컬 동시성 제어 → Redis 분산 락 기반 글로벌 동시성 제어

---

### **성능 개선 핵심 요약**

|    측정 항목    | **전체 로딩** | **분할 처리** | **비동기 큐**  |
|:-----------:|:---------:|:---------:|:----------:|
|  **처리 방식**  |    동기     |    동기     |   **비동기**   |
|  **응답시간**   |   15.6초   |   19.1초   | **즉시 (2ms)** |
| **실제 처리시간** |   15.6초   |   19.1초   |  **3.0초**   |
| **메모리 사용량** |   832MB   |   110MB   |  **18MB**  |
| **분당 처리량**  |   3.2개    |   3.0개    | **32.3개**  |

> [성능 개선 상세 결과 바로가기](./docs/performance-test-results.md)

---

### **기술 스택**
* **Java 17**
* **Spring Boot 3.2**
* **Spring WebSocket**
* **Spring Data JPA**
* **PostgreSQL**
* **Apache POI 5.4.1** (SXSSF)

---

### **향후 개선 계획**
1. **(단기) 라이브러리 교체**: Apache POI를 **FastExcel**로 교체하여 더 높은 메모리 효율성과 쓰기 성능 확보
2. **(장기) 분산 시스템 아키텍처 전환**: 단일 인스턴스 기반 설계를 다중 인스턴스 환경 지원을 위한 분산 시스템으로 리팩토링


---