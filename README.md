# **Excel 대용량 다운로드 최적화 프로젝트**

> 실무에서 겪었던 OOM 문제를 해결한 경험에 동시성 제어와 성능 최적화를 더해
> 대용량 엑셀 다운로드의 안정성과 처리 속도를 개선한 프로젝트
>
> [🛠️ GitHub Repository 바로가기](https://github.com/ji1007k/sb-excel-optimizer)

---

## 프로젝트 개요

- **배경**: 실무 환경에서 엑셀 다운로드 기능 시연 중, 대용량 데이터(10만 건) 동시 요청으로 `OutOfMemoryError(OOM)` 발생 → 서비스 중단 및 파일 손상
- **문제 분석**: 전체 데이터를 메모리에 한 번에 로딩하는 구조가 주 원인
- **목표**: 안정적인 메모리 사용과 동시성 제어를 통해 **대용량 엑셀 다운로드 성능 최적화**

---

## 기술 스택

- **Java 17**
- **Spring Boot 3.2**
- **Spring WebSocket**
- **Spring Data JPA**
- **PostgreSQL**
- **Apache POI 5.4.1 (SXSSF)**

---

## 개선 과정

### **1차: 실무 조치 사항 (OOM 해결)**

- **목표**: 서비스 중단 원인 제거
- **조치**
    1. `XSSF` → `SXSSF` 스트리밍 방식 적용 (메모리 자동 해제)
    2. `전체 SELECT` → `1000건 페이징` 처리
- **결과**
    - 동시 요청 시 OOM 및 Full GC 발생 없이 안정적 처리 가능

---

### **2차: 심화 최적화 (성능 + 안정성 강화)**

- **목표**: 성능 향상 및 사용자 경험 개선
- **조치**
    1. **비동기 처리 시스템** 도입: `BlockingQueue` 기반, 최대 3건 동시 처리
    2. **쿼리 최적화**: `ROWNUM` 기반 → **ID 기반 커서 페이징**(`WHERE id > ? ORDER BY id LIMIT ?`) 전환
- **결과**
    - 분당 처리량 **6배 향상**
    - 즉시 응답 제공 (대기 시간 제거)
    - 안정적 동시 처리 환경 확보

---

## 성능 개선 핵심 요약

| 측정 항목 | **전체 로딩** | **분할 처리** | **비동기 큐** |
| --- | --- | --- | --- |
| **처리 방식** | 동기 | 동기 | **비동기** |
| **응답시간** | 15.6초 | 19.1초 | **즉시 (2ms)** |
| **실제 처리시간** | 15.6초 | 19.1초 | **3.0초** |
| **메모리 사용량** | 832MB | 110MB | **18MB** |
| **분당 처리량** | 3.2개 | 3.0개 | **32.3개** |

> [성능 개선 상세 결과 보기](./docs/performance-test-results.md)

---

## 주요 학습 및 성과

1. **실무 문제 해결 경험**: 운영 중 발생한 OOM을 직접 해결하며 안정성 확보
2. **메모리 관리 역량**: JVM/GC 동작 이해를 통한 최적화 경험
3. **동시성 제어 설계**: BlockingQueue 기반 비동기 아키텍처 구현
4. **쿼리 튜닝 역량**: 커서 페이징 전환으로 인덱스 활용 극대화
5. **서비스 안정성**: 서버 다운 위험 제거 + 안정적 배포 경험
6. **운영 효율성**: 동일 자원 대비 **처리량 10배 향상** 달성

---

## 향후 개선 계획

1. **(단기) 라이브러리 교체:** Apache POI를 **FastExcel**로 교체하여 더 높은 메모리 효율성과 쓰기 성능 검증
2. **(장기) 분산 시스템 아키텍처 전환**: 단일 인스턴스 기반 설계를 다중 인스턴스 환경 지원을 위한 분산 시스템으로 리팩토링


---