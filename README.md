# **Excel 대용량 다운로드 최적화 프로젝트**

> 실무에서 겪었던 OOM 문제를 해결한 경험에 동시성 제어를 더해 대용량 엑셀 다운로드 성능을 최적화한 프로젝트  
> [🛠️ GitHub Repository 바로가기](https://github.com/ji1007k/sb-excel-optimizer)

---

### **프로젝트 개요**
* **배경**: 이전 회사 엑셀 다운로드 기능 시연 중, 대용량 데이터(10만 건) 동시 요청으로 OutOfMemoryError(OOM) 발생 → 서비스 중단 및 파일 손상
* **문제 분석**: 대용량 데이터를 메모리에 한꺼번에 로딩하는 전체 로딩 방식이 주 원인
* **목표**: 동시성 제어를 통한 대용량 엑셀 다운로드 성능과 안정성 최적화

---

### **개선 과정**

#### **1차: 실무 조치 사항 (OOM 해결)**
* **목표**: 서비스 중단의 주원인인 OOM 문제 해결 및 안정성 확보
* **조치**: `XSSF + 전체 SELECT` → `SXSSF + 1000건 페이징`으로 변경
* **결과**: 4GB 힙 메모리 환경에서 20건 동시 요청까지 OOM 및 Full GC 없이 처리 가능

#### **2차: 심화 최적화 (성능 및 동시성 개선)**
* **목표**: 성능 개선 및 동시성 처리량 극대화
* **조치**:
    1.  **DB 쿼리 성능 개선**: ROWNUM 페이징에서 ID 기반 커서 페이징(`WHERE id > ? ORDER BY id LIMIT ?`)으로 변경하여 인덱스 활용한 조회 성능 향상
    2.  **동시성 제어 아키텍처 도입**: BlockingQueue 기반 큐 시스템으로 최대 3건 동시 처리 및 즉시 응답 구현
* **결과**: 분당 처리량 6배 향상 및 즉시 응답으로 사용자 경험을 개선했습니다.

---

### **📈 성능 개선 핵심 요약**

|      측정 항목      | **전체 로딩** | **분할 처리** | **비동기 큐**  |
|:---------------:|:---------:|:---------:|:----------:|
|    **응답시간**     |    OOM    |   7분 5초   | **즉시 응답**  |
|   **실제 처리시간**   |    불가     |   7분 5초   | **2분 23초** |
|   **메모리 사용량**   |    OOM    |   72MB    |  **32MB**  |
| **동시 처리 가능 여부** |     X     |     X     |     O      |
|   **분당 처리량**    |    0개     |   0.1개    |  **0.6개**  |

> [성능 개선 상세 결과 바로가기](./docs/performance-test-results.md)

---

### 기술 스택
* **Java 17**
* **Spring Boot 3**
* **Spring WebSocket**
* **Spring Data JPA**
* **PostgreSQL**
* **Apache POI 5.4.1** (SXSSF)

---

### **주요 학습 및 성과**
1. **실무 문제 해결**: 단계적 접근을 통한 운영 환경 문제 해결 경험
2. **메모리 관리**: JVM 및 GC 원리 이해를 통한 OOM 근본 해결
3. **동시성 제어**: 큐 기반 시스템을 통한 안정적 아키텍처 설계 역량
4. **서비스 안정성**: OOM 서버 다운 위험 제거
5. **사용자 경험**: 즉시 응답을 통한 사용자 경험 혁신
6. **운영 효율성**: 동일 하드웨어 대비 6배 처리량 향상

---

### **향후 개선 계획**
1. **(단기) 라이브러리 교체**: Apache POI를 **FastExcel**로 교체하여 더 높은 메모리 효율성과 쓰기 성능을 확보
2. **(장기) 분산 시스템 아키텍처 전환**: 단일 인스턴스 기반 설계를 다중 인스턴스 환경 지원을 위한 분산 시스템으로 리팩토링
   - 인메모리 상태 → Redis 기반 분산 상태 관리
   - BlockingQueue → Redis Stream/RabbitMQ 기반 메시지 큐
   - 로컬 동시성 제어 → Redis 분산 락 기반 글로벌 동시성 제어

---

